var loggy=function(){"use strict";var e={generateUTCInSeconds:{generateUTCInSeconds:function(){return Math.floor(Date.now()/1e3)}}.generateUTCInSeconds,includes:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}},t=function(){var t=[];return{add:function(n){var o={innerText:n.target.innerText,timestamp:e.generateUTCInSeconds(),element:n.target.tagName.toLowerCase(),elementId:n.target.id,location:window.location.pathname};t.push(o),t.length>25&&t.shift()},get:function(){return t}}}(),n={focusableElements:["button","details","input","iframe","select","textarea"],connectivity:{service:{local:"http://localhost:2800",demo:"https://loggy-demo-qvnfzcesoq-ew.a.run.app",prod:"https://loggy-prod-qvnfzcesoq-ew.a.run.app"}},adapter:{name:"loggy-adapter-browser",type:"browser",version:"v0.1.7"},consentKey:"loggy-analytics-enabled",sessionKey:"loggy-analytics-active-session"};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s,c,l,u=(s={},c=new Date,{add:function(e){e&&"object"===o(e)&&e.constructor===Object&&(s=a({},s,{},e))},setBasicAnalyticData:function(){var e=window.location.pathname;s.isNewVisitor=null===localStorage.getItem(n.consentKey),s.isNewSession=null===sessionStorage.getItem(n.sessionKey),s.page="/"===e[0]?e:"/"+e,s.referrer=document.referrer||"direct",localStorage.setItem(n.consentKey,"true"),sessionStorage.setItem(n.sessionKey,"true")},get:function(){return s.timeOnPage=Math.floor((new Date-c)/1e3),s}}),d=(l={sendAnalytics:!1},{set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!==o(e)||e.constructor!==Object)throw new Error("the provided LOGGY config is not a valid object");if(!e.ticket||"string"!=typeof e.ticket||50!==e.ticket.length)throw new Error("the provided LOGGY ticket is invalid");if(e.badges&&e.badges.constructor!==Object)throw new Error("the provided LOGGY badges need to be an object");Object.keys(e.badges||{}).forEach((function(t){if("string"!=typeof e.badges[t])throw new Error("LOGGY badges can only contain strings")})),l=a({},l,{},e)},setSendAnalytics:function(e){return l=a({},l,{sendAnalytics:e})},get:function(){return l}}),g=function(){var e=d.get(),t=n.connectivity.service[e.instance]||n.connectivity.service.prod;return e.endpoint&&(t=e.endpoint),t},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",n=new XMLHttpRequest,o=g(),r="/logging/"+t;n.open("POST",o+r,"error"===t),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e)),n.onreadystatechange=function(){4===this.readyState&&200!==this.status&&console.error("failed to send event to LOGGY with error:",this.statusText)}},y=f,p=function(e){if("sendBeacon"in navigator){var t=g();navigator.sendBeacon(t+"/logging/analytics",JSON.stringify(e))}else f(e,"analytics")},v=function(){var t=[];return{add:function(n){"string"==typeof n&&(t.push({timestamp:e.generateUTCInSeconds(),type:"log",log:n}),t.length>15&&t.shift())},get:function(){return t}}}(),b=function(o){var r=o.message,i=o.path,s=void 0===i?"":i,c=o.line,l=void 0===c?"":c,u=o.stack,g=o.constructor,f=d.get();if(r&&u&&f.ticket){var p=a({ticket:f.ticket,message:r,path:s,logs:v.get()},f.badges&&{badges:f.badges},{line:l.toString(),type:g&&g.name||"error",userInteractions:t.get(),host:window.location.origin,stacktrace:u,adapter:n.adapter,timestamp:e.generateUTCInSeconds()});y(p)}},m=function(){var e=d.get(),t=u.get();t.ticket=e.ticket,e.sendAnalytics&&p(t)},w=function(){var e="";window.onerror=function(t,n,o,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(t===e)return!1;e=t,setTimeout((function(){return e=""}),2e3);var a={message:t,path:n,line:o,column:r=r||window.event&&window.event.errorCharacter,stack:i.stack,constructor:i.constructor};return b(a),!1}},h=function(){var o=n.focusableElements;window.addEventListener("focusin",(function(n){var r=n.target.tagName.toLowerCase();e.includes(o,r)&&t.add(n)})),document.addEventListener("click",(function(n){var r=n.target.tagName.toLowerCase();e.includes(o,r)||t.add(n)}))},O=function(){window.addEventListener("beforeunload",m)},S=function(){var e=console.log.bind(console);console.log=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];v.add(n.join(" ")),e.apply(void 0,n)};var t=console.info.bind(console);console.info=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];v.add(n.join(" ")),t.apply(void 0,n)};var n=console.error.bind(console);console.error=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];v.add(t.join(" ")),n.apply(void 0,t)}};return{init:function(e){"sendAnalytics"in e||(e.sendAnalytics=null!==localStorage.getItem(n.consentKey)),d.set(e),S(),h(),w(),e.sendAnalytics&&(O(),u.setBasicAnalyticData())},emitError:function(e){var t=(e.stack.replace("at ","").split("\n")[1]||"").split(":");e.line=t[t.length-2],e.path=t.slice(0,-2).join(":").trim(),b(e)},enableAnalytics:function(){d.setSendAnalytics(!0),O(),u.setBasicAnalyticData()},disableAnalytics:function(){d.setSendAnalytics(!1),sessionStorage.removeItem(n.sessionKey),localStorage.removeItem(n.consentKey)}}}();
